{% extends "base.html" %}

{% block title %}Créer un exercice{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Créer un nouvel exercice</h2>
    
    <form method="POST" id="exerciseForm" class="mt-4" enctype="multipart/form-data">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        
        <div class="mb-3">
            <label for="title" class="form-label">Titre</label>
            <input type="text" class="form-control" id="title" name="title" required>
        </div>
        
        <div class="mb-3">
            <label for="description" class="form-label">Description</label>
            <textarea class="form-control" id="description" name="description" rows="3"></textarea>
        </div>
        
        <div class="mb-3">
            <label for="exercise_type" class="form-label">Type d'exercice</label>
            <select class="form-select" id="exercise_type" name="exercise_type" required>
                <option value="">Choisir un type d'exercice</option>
                {% for type_code, type_name in exercise_types %}
                <option value="{{ type_code }}">{{ type_name }}</option>
                {% endfor %}
            </select>
        </div>
        
        <!-- Zone pour le dépôt de fichier -->
        <div id="fileUploadConfig" style="display: none;">
            <div class="mb-3">
                <label for="allowed_extensions" class="form-label">Extensions autorisées (séparées par des virgules)</label>
                <input type="text" class="form-control" id="allowed_extensions" name="allowed_extensions" placeholder="pdf, doc, docx">
                <div class="form-text">Laissez vide pour autoriser tous les types de fichiers</div>
            </div>
            <div class="mb-3">
                <label for="max_file_size" class="form-label">Taille maximale du fichier (en Mo)</label>
                <input type="number" class="form-control" id="max_file_size" name="max_file_size" value="10">
            </div>
        </div>
        
        <!-- Zone pour les mots mêlés -->
        <div id="wordSearchConfig" style="display: none;">
            <div class="mb-3">
                <label for="words" class="form-label">Mots à trouver (séparés par des virgules)</label>
                <input type="text" class="form-control" id="words" name="words">
                <div class="form-text">Exemple: chat, chien, oiseau</div>
            </div>
        </div>
        
        <!-- Zone pour les paires -->
        <div id="pairsConfig" style="display: none;">
            <div id="pairsList">
                <div class="pair-item mb-3">
                    <div class="row">
                        <div class="col">
                            <label class="form-label">Élément 1</label>
                            <input type="text" class="form-control" name="pair_left[]" required>
                        </div>
                        <div class="col">
                            <label class="form-label">Élément 2</label>
                            <input type="text" class="form-control" name="pair_right[]" required>
                        </div>
                    </div>
                </div>
            </div>
            <button type="button" class="btn btn-secondary mt-2" onclick="addPair()">
                <i class="fas fa-plus"></i> Ajouter une paire
            </button>
        </div>
        
        <!-- Zone pour les QCM -->
        <div id="qcmConfig" style="display: none;">
            <div id="questionsList">
                <!-- Les questions seront ajoutées ici dynamiquement -->
            </div>
            <button type="button" class="btn btn-secondary mt-2" onclick="addQuestion()">
                <i class="fas fa-plus"></i> Ajouter une question
            </button>
        </div>

        <div class="mt-4">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-plus"></i> Créer l'exercice
            </button>
            <a href="{{ url_for('exercise_library') }}" class="btn btn-secondary">
                <i class="fas fa-times"></i> Annuler
            </a>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const exerciseType = document.getElementById('exercise_type');
    const fileUploadConfig = document.getElementById('fileUploadConfig');
    const wordSearchConfig = document.getElementById('wordSearchConfig');
    const pairsConfig = document.getElementById('pairsConfig');
    const qcmConfig = document.getElementById('qcmConfig');

    exerciseType.addEventListener('change', function() {
        // Cacher toutes les zones de configuration
        fileUploadConfig.style.display = 'none';
        wordSearchConfig.style.display = 'none';
        pairsConfig.style.display = 'none';
        qcmConfig.style.display = 'none';

        // Afficher la zone correspondante au type sélectionné
        switch(this.value) {
            case 'file_upload':
                fileUploadConfig.style.display = 'block';
                break;
            case 'word_search':
                wordSearchConfig.style.display = 'block';
                break;
            case 'pairs':
                pairsConfig.style.display = 'block';
                break;
            case 'qcm':
                qcmConfig.style.display = 'block';
                break;
        }
    });
});

function addQuestion() {
    const questionsList = document.getElementById('questionsList');
    const questionCount = questionsList.children.length;
    
    const questionDiv = document.createElement('div');
    questionDiv.className = 'card mb-3';
    questionDiv.innerHTML = `
        <div class="card-body">
            <h5 class="card-title">Question ${questionCount + 1}</h5>
            <div class="mb-3">
                <label class="form-label">Question</label>
                <input type="text" class="form-control" name="question_${questionCount}" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Options</label>
                <div class="options-container" id="options_${questionCount}">
                    <div class="input-group mb-2">
                        <input type="text" class="form-control" name="options_${questionCount}[]" required>
                        <div class="input-group-text">
                            <input class="form-check-input" type="radio" name="correct_${questionCount}" required>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn btn-secondary btn-sm mt-2" onclick="addOption(${questionCount})">
                    <i class="fas fa-plus"></i> Ajouter une option
                </button>
            </div>
            <button type="button" class="btn btn-danger btn-sm" onclick="this.closest('.card').remove()">
                <i class="fas fa-trash"></i> Supprimer la question
            </button>
        </div>
    `;
    
    questionsList.appendChild(questionDiv);
}

function addOption(questionId) {
    const optionsContainer = document.getElementById(`options_${questionId}`);
    const optionDiv = document.createElement('div');
    optionDiv.className = 'input-group mb-2';
    optionDiv.innerHTML = `
        <input type="text" class="form-control" name="options_${questionId}[]" required>
        <div class="input-group-text">
            <input class="form-check-input" type="radio" name="correct_${questionId}" required>
        </div>
        <button type="button" class="btn btn-danger" onclick="this.closest('.input-group').remove()">
            <i class="fas fa-minus"></i>
        </button>
    `;
    optionsContainer.appendChild(optionDiv);
}

function addPair() {
    const pairsList = document.getElementById('pairsList');
    const pairDiv = document.createElement('div');
    pairDiv.className = 'pair-item mb-3';
    pairDiv.innerHTML = `
        <div class="row">
            <div class="col">
                <label class="form-label">Élément 1</label>
                <input type="text" class="form-control" name="pair_left[]" required>
            </div>
            <div class="col">
                <label class="form-label">Élément 2</label>
                <input type="text" class="form-control" name="pair_right[]" required>
            </div>
            <div class="col-auto d-flex align-items-end">
                <button type="button" class="btn btn-danger mb-3" onclick="this.closest('.pair-item').remove()">
                    <i class="fas fa-minus"></i>
                </button>
            </div>
        </div>
    `;
    pairsList.appendChild(pairDiv);
}
</script>
{% endblock %}
